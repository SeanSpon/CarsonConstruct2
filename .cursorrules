# PodClip - Agent Instructions

## Project Overview
PodClip is a simple, deterministic command-line tool for generating short vertical clips from long podcast videos.

## Philosophy
- **No hype AI abstractions** - Just Whisper for transcription, everything else is deterministic
- **No dead code** - Every file has a clear purpose
- **One clear pipeline** - Input → Transcription → Detection → Captions → Export
- **Readable in one sitting** - Simple, well-commented code

## Pipeline Architecture

```
podclip/
├── input/         → Load video, extract audio, validate
├── transcription/ → Whisper word-level timestamps (SINGLE SOURCE OF TRUTH)
├── detection/     → Deterministic clip detection
├── captions/      → Karaoke-style ASS captions
├── editing/       → Rule-based angle switching, b-roll
└── export/        → FFmpeg vertical 9:16 export
```

## Key Files

| File | Purpose |
|------|---------|
| `cli.py` | Main entry point, orchestrates pipeline |
| `input/loader.py` | Video loading, audio extraction, FFmpeg helpers |
| `transcription/whisper.py` | OpenAI Whisper API, transcript dataclasses |
| `detection/candidates.py` | Detect clip candidates (speech density, silence breaks) |
| `detection/scoring.py` | Score and rank clips (deterministic formula) |
| `captions/karaoke.py` | Generate ASS subtitles with word timing |
| `editing/angle_switch.py` | Rule-based camera switching |
| `editing/broll.py` | Rule-based b-roll overlay |
| `export/vertical.py` | FFmpeg 9:16 export with caption burning |

## Usage

```bash
# Basic usage
python -m podclip input.mp4 --out clips/

# With options
python -m podclip input.mp4 --out clips/ -n 15 --min-duration 20 --max-duration 45
```

## Dependencies
- Python 3.8+
- FFmpeg (system install)
- openai (for Whisper)

## Design Rules
1. **Transcript is truth** - All timing from Whisper words/segments
2. **Deterministic scoring** - No ML, explicit formula
3. **Minimal deps** - Only `openai` + FFmpeg
4. **No state** - Each run is independent

## Testing
```bash
cd podclip
python -m pytest tests/  # When tests exist
```

## Common Tasks

### Adding a new detection method
1. Add function in `detection/candidates.py`
2. Return `Candidate` objects
3. It's auto-included in ranking

### Adding a caption style
1. Add to `CaptionStyle` enum in `captions/karaoke.py`
2. Define colors in `get_style_colors()`
3. Expose via CLI

### Modifying scoring
Edit `detection/scoring.py` - all weights are explicit
